<!--pages/home/index.wxml-->
<view class="page home">
  <!-- nav -->
  <custom-nav-bar title="今日待办" i-bg="i-bg">
  </custom-nav-bar>

  <view class="home__header">
    <view class="home__header__date">
      <text class="date__main">{{month}}-{{day}}</text>
      <text class="date__year">{{year}}</text>
    </view>
    <view class="home__header__progress">
      <van-progress stroke-width="10" pivot-color="#00c261" color="linear-gradient(to right, #00c261, #00c261)"
        percentage="{{DegreeOfCompletion}}" />
    </view>
  </view>

  <scroll-view scroll-y style="width: 100%;height:calc(100% - {{statusBarHeight}}rpx - {{navBarHeight}}rpx - 50px)" refresher-enabled="{{true}}" refresher-threshold="{{100}}"
    refresher-default-style="black" refresher-background="white" refresher-triggered="{{triggered}}"
    bindrefresherrefresh="onScrollRefresh">
    <!-- 待办列表 -->
    <empty-page style="height: 100%" title="今天还没有任务哦～" wx:if="{{taskList.length === 0}}"></empty-page>
    <block wx:else>
      <view class="home__task-container">
        <task-item wx:for="{{taskList}}" bind:refresh="refresh" wx:key="_id" taskItem="{{item}}"></task-item>
        <text wx:if="{{taskList.length > 5}}" class="list-end">到底啦～</text>
      </view>
    </block>
  </scroll-view>

  <image bindtap="toAddTask" src="../../images/home/addTask.png" style="width: 70rpx; height: 70rpx;"
    class="home__add-task"></image>

  <!-- 表单内容 -->
  <van-popup show="{{ openTaskPage }}" round position="bottom" custom-style="padding: 40rpx" bind:close="onClose">
    <van-cell-group>
      <van-field model:value="{{ taskName }}" required clearable label="任务名" placeholder="请输入任务名称" />
      <van-field model:value="{{ remark }}" label="备注" clearable placeholder="请输入备注" />
      <view class="task-tip">
        提示：将使用系统内置的
        <text class="task-tip--detail" bindtap="queryDefaultRuleDesc"> 五毒刷题 </text>规则
      </view>
    </van-cell-group>
    <van-button type="primary" bindtap="addTask">确认</van-button>
  </van-popup>

  <!-- 验证弹窗 -->
  <van-popup show="{{isShow}}" position="bottom">
    <login-com bind:changeAuthorize="changeAuthorize"></login-com>
  </van-popup>
</view>